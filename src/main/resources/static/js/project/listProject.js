var laydate=layui.laydate;laydate.render({elem:'#selectTime',type:'datetime',range:true,format:'yyyy-MM-dd HH:mm:ss'});var grid=$("#tableView").bootstrapTable({url:URL.API_HOST+"/project/listProject",height:document.body.clientHeight*0.821,method:"post",dataType:"json",contentType:"application/x-www-form-urlencoded",pagination:true,pageList:[10,20,50,100,200,500],sortable:false,sortOrder:"asc",pageSize:20,pageNumber:1,queryParamsType:"undefined",striped:true,sidePagination:"server",ajaxOptions:{headers:{"Authorization":getCookie("token")}},columns:[{field:'id',title:'编号',align:'center',sortable:true,width:50},{field:'name',title:'项目名称',align:'center',width:120,formatter:function(value,row,index){return"<button class='btn btn-info btn-rounded btn-xs' data-clipboard-text='"+value+"'>"+value+"</a>"}},{field:'secret',title:'secret',align:'center',width:100,formatter:function(value,row,index){return"<button class='btn btn-danger btn-rounded btn-xs' data-clipboard-text='"+value+"'>"+value+"</a>"}},{field:'state',title:'状态',align:'center',width:50,formatter:function(value,row,index){if(value==1){return"<button class='btn btn-primary btn-rounded btn-xs'>正常</a>"}else if(value==2){return"<button class='btn btn-warning btn-rounded btn-xs'>停用</a>"}else{return"<button class='btn btn-default btn-rounded btn-xs'>未知</a>"}}},{field:'remark',title:'备注',align:'center',width:400},{field:'addTime',title:'创建时间',align:'center',width:180},{field:'',title:'操作',formatter:function(value,row,index){let result="";if(row.state===1){result=result+"<button class='layui-btn layui-btn-xs layui-btn-primary' onClick='javascript:changeState("+row.id+",2)'>停用</button>"}else{result=result+"<button class='layui-btn layui-btn-xs layui-btn' onClick='javascript:changeState("+row.id+",1)'>启用</button>"}result+="<button class='layui-btn  layui-btn-xs layui-btn-danger' onClick='javascript:deleteOne("+row.id+")'>删除</button>";return result}}],onLoadSuccess:function(res){if(res.code!=200){showTip(res.msg)}},onLoadError:function(status){console.log(status);showErrorMsg(TIPS.ERROR)},responseHandler:function(res){res.total=res.data.total;res.list=res.data.list;res.pageNum=res.data.pageNum;res.pageSize=res.data.pageSize;res.pages=res.data.pageSize;res.data.startRow=res.data.startRow;res.endRow=res.data.endRow;return res},queryParams:queryParams});function reload(){grid.bootstrapTable('refresh')}function queryParams(params){var keyword=$("#keyword").val();if(keyword!=''){params.keyword=keyword}var selectTime=$("#selectTime").val();if(selectTime!=''){let times=selectTime.split(" - ");if(times.length===2){params.startTime=times[0];params.endTime=times[1]}}var state=$("#state").val();if(state!=''){params.state=state}else{params.state=0}return params}function resetSearch(){$("#keyword").val('');$("#selectTime").val('');$("#state").val(0);grid.bootstrapTable('resetFormSearch')}function deleteOne(id){showConfirm("温馨提示","该项目下的所有文件也将被删除，您确定要删除该项目吗？",function(index){$.ajax({url:URL.API_HOST+"/project/deleteProject",type:"post",dataType:"json",data:"id="+id,headers:{'Authorization':getCookie("token")},success:function(res){if(res.code==200){showMsg("删除成功");layer.close(index);reload()}else{showTip(res.msg)}},error:function(XMLHttpRequest,textStatus,errorThrown){showTip(TIPS.ERROR)}})})}function changeState(id,state){$.ajax({url:URL.API_HOST+"/project/changeState",type:"post",dataType:"json",data:"id="+id+"&state="+state,headers:{'Authorization':getCookie("token")},success:function(res){if(res.code==200){showMsg("修改状态成功");reload()}else{showTip(res.msg)}},error:function(XMLHttpRequest,textStatus,errorThrown){showTip(TIPS.ERROR)}})}var clipboard=new ClipboardJS('.btn');clipboard.on('success',function(e){showMsg("复制成功");console.log(e)});clipboard.on('error',function(e){showTip("复制失败");console.log(e)});function addProject(){layer.open({type:2,anim:1,title:"新增项目",content:'addProject',btn:['确定','取消'],btnAlign:'c',resize:false,scrollbar:false,area:['700px','350px'],yes:function(index,layero){const body=layer.getChildFrame('#popupLayer',index);const projectName=body.find("input[id='projectName']").val();const remark=body.find("textarea[id='remark']").val();if(projectName===''){showTip("项目名称不能为空");return false}if(projectName.length>255){showTip("项目名称长度不能大于255");return false}if(remark.length>2550){showTip("备注长度不能大于2550");return false}$.ajax({url:URL.API_HOST+"/project/addProject",type:"post",dataType:"json",data:"name="+projectName+"&remark="+remark,headers:{'Authorization':getCookie("token")},success:function(res){if(res.code===200){showMsg("新增项目成功");layer.close(index);reload()}else{showTip(res.msg)}},error:function(XMLHttpRequest,textStatus,errorThrown){showErrorMsg(TIPS.ERROR)}})},btn2:function(index,layero){layer.close(index)}})}function runoob(){console.log('Hello World!')}